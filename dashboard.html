<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TravelLens</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body class="dashboard-body">

<div class="dashboard-header">
    <h1 class="dashboard-logo">TravelLens</h1>
</div>

<section class="dashboard" class="dashboard-bg">

    <h2 id="dashboardTitle">Smart Travel Planning</h2>

    <!-- Mood Selection -->
    <div class="mood-section">
        <h3>Select Your Travel Mood</h3>
        <div class="mood-options">
            <button class="mood-btn">Relaxed</button>
            <button class="mood-btn">Adventure</button>
            <button class="mood-btn">Romantic</button>
            <button class="mood-btn">Spiritual</button>
            <button class="mood-btn">Party</button>
        </div>
    </div>

    <!-- Destination + Budget -->
    <div class="input-section">
        <input type="number" id="budgetInput" placeholder="Enter Budget (₹)">
        <button id="analyzeBtn" class="btn-primary">Analyze Trip</button>
    </div>

    <!-- Info Cards -->
    <div class="info-cards">
        <div class="info-card">
            <h4>Weather</h4>
            <p>--</p>
        </div>
        <div class="info-card">
            <h4>Smart Travel Score</h4>
            <p>--</p>
        </div>
    </div>

    <!-- Recommended Attractions -->
    <div class="recommendations">
        <h3>Recommended Attractions</h3>
        <div class="card-grid">
            <!-- Will be dynamically populated -->
        </div>
    </div>

    <div style="text-align:center; margin-top:40px;">
        <a href="planner.html" class="btn-primary" style="text-decoration: none;">Generate Itinerary</a>
    </div>

</section>

<script src="js/engine.js"></script>
<script>

document.addEventListener("DOMContentLoaded", function () {

    let selectedMood = null;

    const moodButtons = document.querySelectorAll(".mood-btn");
    const analyzeBtn = document.getElementById("analyzeBtn");
    const budgetInput = document.getElementById("budgetInput");

    moodButtons.forEach(btn => {
        btn.addEventListener("click", () => {

            if (btn.classList.contains("active")) {
                btn.classList.remove("active");
                selectedMood = null;
            } else {
                moodButtons.forEach(b => b.classList.remove("active"));
                btn.classList.add("active");
                selectedMood = btn.textContent;
            }
        });
    });

    analyzeBtn.addEventListener("click", async function () {

        if (!selectedMood) {
            alert("Please select a mood.");
            return;
        }

        const budget = budgetInput.value;

        if (!budget || budget <= 0) {
            alert("Please enter a valid budget.");
            return;
        }

        const response = await fetch("assets/data/destinations.json");
        const data = await response.json();

        const engine = new TravelEngine(data);
        const ranked = engine.rankDestinations(selectedMood, budget);

        displayResults(ranked);
    });

});

function displayResults(results) {

    const container = document.querySelector(".recommendations .card-grid");
    container.innerHTML = "";

    results.forEach((item, index) => {

        const card = document.createElement("div");
        card.classList.add("card");

        // Set background image dynamically
        card.style.backgroundImage = `url('${item.image}')`;
        card.style.backgroundSize = "cover";
        card.style.backgroundPosition = "center";
        card.style.backgroundRepeat = "no-repeat";

        // Determine score color
        let scoreClass = "score-low";
        if (item.score >= 80) scoreClass = "score-high";
        else if (item.score >= 60) scoreClass = "score-medium";

        // Top Pick Badge
        const badge = index === 0 
            ? `<div class="top-badge">⭐ Top Pick</div>` 
            : "";

        card.innerHTML = `
            ${badge}
            <div class="overlay">
                <h3>${item.name}</h3>
                <p class="smart-score ${scoreClass}">
                    Smart Score: <span class="score-value" data-score="${item.score}">0</span>/100
                </p>
                <p class="why-text">
                    Best suited for your selected mood and budget.
                </p>
            </div>
        `;

        container.appendChild(card);
    });

    animateScores();
}

function animateScores() {

    const scoreElements = document.querySelectorAll(".score-value");

    scoreElements.forEach(el => {

        const target = Number(el.getAttribute("data-score"));
        let current = 0;

        const interval = setInterval(() => {
            current += 1;
            el.textContent = current;

            if (current >= target) {
                clearInterval(interval);
            }
        }, 15);

    });
}
</script>
<script src="js/session.js"></script>
</body>
</html>
